---
title: "Part 01 Fix Raw Data"
output:
  html_document:
    df_print: paged
---

Script para cálculo do LPI baseado nas instruções disponíveis [neste link](https://github.com/Zoological-Society-of-London/rlpi).

Função prepara dados do icmbio e chama funções do pacote rlpi

**Em fase de TESTE**

Adaptação: Elildo Carvalho Jr, ICMBio/CENAP.

Colaboração: Fernando Lima

### Carregar pacotes

```{r pacotes}
library(here)
library(readr)
library(lubridate)
library(dplyr)
library(stringr)
```

## Planilha consolidada MastoAves

### Ler dados, versao não disponibilizada, mas mais atualizada

Deletei coordenadas geográficas:
Linha 2298 - S 04° 16" 44.1", W 55° 59' 35.4"
Linha 2517 - "Distância estimada. estava na outra margem do igarapé: S 4° 36' 32"", w 56° 24' 51.2"""
Linha 2526 - "Ás 8h40 tiveram contato auditivo com Panthera onca. que os acompanhou. na outra margem do igarapé. coordenadas 04° 32' 06.9"", 56° 19'39.7"". no mesmo local onde foi registrado A. nigerrima no dia 12/11/17"
Linha 3301 - retirada vírgulas de comentários
Linha 3308 - 
Linha 3310 - 
Linha 3316 - 
Linha 3328 - 
Linha 3371
3647

```{r leitura}
dados <- read_csv(here("data", "Planilha.consolidada.mastoaves.ate.2019a.csv"), show_col_types = FALSE)
```

### Ajustar dados: versao nao disponibilizada, mas mais atualizada

```{r}
dados <- dados %>%
  rename(cnuc = "CDUC",
         nome_UC = "Local - Nome da Unidade de Conservacao",
         estacao_amostral = "Numero da Estacao Amostral",
         nome_ea = "Nome da EA",
         esforco = "Esforco de amostragem tamanho da trilha (m)",
         data = "data da amostragem",
         hora_inicio = "horario de inicio  (h:mm)",
         hora_fim = "horario de termino (h:mm)",
         ano = "Ano",
         classe = "Classe",
         ordem = "Ordem",
         familia = "Familia",
         genero = "Genero",
         binomial = "Especies validadas para analise do ICMBio",
         n_animais = "n de animais",
         distancia = "distancia (m) do animal em relacao a trilha") %>%
  mutate(data = as.Date(data, "%d/%m/%Y"),
         ano = year(data),
         populacao = paste(binomial, cnuc, sep ="_"),
         populacao = str_replace(populacao, " ", "_")) %>%
  select(cnuc, nome_UC, estacao_amostral, nome_ea, esforco, ano, data,
         hora_inicio, hora_fim, classe, ordem, familia, genero, binomial,
         n_animais, distancia, populacao)
```

### Exportar arquivo

```{r exportar}
saveRDS(dados, here("data", "dadosICMBio_2014a2019.rds"))
```

## Dados Florestal

### Ler dados (versão oficial disponibilizada)

```{r}
dados <- read_csv(here("data", "Dados_Florestal_14a18_disponibilizacao.csv"))
```

### Ajustes (versão oficial disponibilizada)

```{r}
dados <- dados %>%
  rename(
    cnuc = "Cadastro Nacional de Unidades de Conservação (CNUC)",
    nome_UC = "Unidade de Conservação (UC)",
    estacao_amostral = "Número da Estação Amostral",
    nome_ea = "Nome da Estação Amostral",
    esforco = "Esforço de amostragem (metros percorridos por dia)",
    data = "data da amostragem (dd/mm/aaaa)",
    hora_inicio = "Horário de início  (hh:mm)",
    hora_fim = "Horário de término (hh:mm)",
    ano = "Ano",
    classe = "Classe",
    ordem = "Ordem",
    familia = "Família",
    genero = "Gênero",
    binomial = "Espécies validadas pelo ICMBio",
    n_animais = "N° de animais",
    distancia = "Distância perpendicular  (m) do animal em relação a trilha"
    ) %>%
  mutate(
    data = as.Date(data, "%d/%m/%Y"),
    distancia =  as.numeric(str_replace(distancia, ",", ".")),
    populacao = paste(binomial, cnuc, sep ="_"),
    populacao = str_replace(populacao, " ", "_")
    ) %>%
  select(
    cnuc,
    nome_UC,
    estacao_amostral,
    nome_ea,
    esforco,
    ano,
    data,
    hora_inicio,
    hora_fim,
    classe,
    ordem,
    familia,
    genero,
    binomial,
    n_animais,
    distancia,
    populacao
    )
#dados
```

### Exportar arquivo

```{r}
saveRDS(dados, here("data", "dadosICMBio_2014a2018.rds"))
```
